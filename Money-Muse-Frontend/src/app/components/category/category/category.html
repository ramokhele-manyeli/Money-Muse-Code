<div class="category-layout">
  <!-- Navbar -->
  <app-navbar 
    [isOpen]="isMobileMenuOpen"
    [currentRoute]="currentRoute"
    (toggleMenu)="onToggleMobileMenu()"
    (closeMenu)="onCloseMobileMenu()"
    (navigateToRoute)="onNavigate($event)">
  </app-navbar>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-wrapper">
      <!-- Header -->
      <div class="page-header">
        <div class="header-content">
          <div>
            <h1 class="page-title">Categories</h1>
            <p class="page-subtitle">Organize your transactions with custom categories</p>
          </div>
          <button class="add-btn" (click)="handleAddCategory()">
            <lucide-icon [name]="Plus" [size]="16"></lucide-icon>
            Create Category
          </button>
        </div>
      </div>

      <!-- Metrics Grid -->
      <div class="metrics-grid">
        <div class="metric-card" *ngFor="let metric of metricsData; trackBy: trackByMetricId">
          <div class="metric-header">
            <span class="metric-label">{{ metric.label }}</span>
            <lucide-icon [name]="metric.icon" [size]="18" class="metric-icon"></lucide-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ metric.value }}</div>
            <p class="metric-change" [class.positive]="metric.changeType === 'positive'" [class.negative]="metric.changeType === 'negative'">
              <span *ngIf="metric.change">{{ metric.change }}</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Main Content Section -->
      <div class="main-section">
        <!-- Tab Navigation and Search -->
        <div class="filter-card">
          <div class="tab-nav">
            <div class="tab-buttons">
              <button 
                class="tab-btn"
                [class.active]="activeTab === 'custom'"
                (click)="setActiveTab('custom')">
                My Categories
              </button>
              <button 
                class="tab-btn"
                [class.active]="activeTab === 'system'"
                (click)="setActiveTab('system')">
                System Defaults
              </button>
            </div>

            <!-- Search -->
            <div class="search-container">
              <lucide-icon [name]="Search" [size]="16" class="search-icon"></lucide-icon>
              <input
                type="text"
                placeholder="Search categories..."
                [(ngModel)]="searchQuery"
                class="search-input"
              />
            </div>
          </div>

          <!-- System Categories Info Alert -->
          <div *ngIf="activeTab === 'system'" class="info-alert">
            <lucide-icon [name]="Info" [size]="16" class="info-icon"></lucide-icon>
            <p>System categories cannot be modified. They provide a consistent foundation for your financial tracking.</p>
          </div>
        </div>

        <!-- Categories Content -->
        <div *ngIf="paginatedCategories.length > 0 || (activeTab === 'custom' && customCategories.length === 0 && !searchQuery); else emptyState">
          
          <!-- Empty Custom Categories State (First Time) -->
          <div *ngIf="activeTab === 'custom' && customCategories.length === 0 && !searchQuery" class="first-time-state">
            <div class="first-time-icon">ðŸ“‚</div>
            <h3 class="first-time-title">Create your first category</h3>
            <p class="first-time-description">
              Custom categories help you organize your transactions exactly the way you want
            </p>
            <button class="add-btn get-started-btn" (click)="handleAddCategory()">
              Get Started
            </button>
          </div>

          <!-- Categories Grid -->
          <div *ngIf="paginatedCategories.length > 0" class="categories-grid">
            <!-- Add Category Card (only for custom tab) -->
            <div *ngIf="activeTab === 'custom'" class="category-card add-card" (click)="handleAddCategory()">
              <div class="add-card-content">
                <div class="add-icon">
                  <lucide-icon [name]="Plus" [size]="24"></lucide-icon>
                </div>
                <span class="add-text">Create Category</span>
              </div>
            </div>

            <!-- Category Cards -->
            <div *ngFor="let category of paginatedCategories; trackBy: trackByCategoryId" class="category-card">
              <div class="card-content">
                <!-- Card Header with Icon and Actions -->
                <div class="card-header">
                  <div 
                    class="category-icon"
                    [style.background-color]="getCategoryBackgroundColor(category.colorCode)">
                    {{ category.icon }}
                  </div>
                  <div *ngIf="!category.isSystem" class="card-actions">
                    <button class="action-btn edit-btn" (click)="handleEditCategory(category)">
                      <lucide-icon [name]="Edit2" [size]="14"></lucide-icon>
                    </button>
                    <button class="action-btn delete-btn" (click)="handleDeleteCategory(category)">
                      <lucide-icon [name]="Trash2" [size]="14"></lucide-icon>
                    </button>
                  </div>
                </div>

                <!-- Category Info -->
                <div class="card-body">
                  <h3 class="category-name">{{ category.name }}</h3>
                  <span class="category-type-badge" [ngClass]="getCategoryTypeClass(category.type)">
                    {{ category.type }}
                  </span>
                  <div class="transaction-count">
                    {{ category.transactionCount }} transaction{{ category.transactionCount !== 1 ? 's' : '' }}
                  </div>

                  <!-- System category additional info -->
                  <div *ngIf="category.isSystem" class="system-badge">
                    System
                  </div>

                  <!-- Custom category description -->
                  <p *ngIf="category.description" class="category-description">
                    {{ category.description }}
                  </p>
                </div>

                <!-- Hover overlay for system categories -->
                <div *ngIf="category.isSystem" class="hover-overlay">
                  <div class="overlay-content">
                    <div class="overlay-title">View Details</div>
                    <div class="overlay-text">{{ category.transactionCount }} total transactions</div>
                    <div class="overlay-subtext">Last used: 2 days ago</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pagination -->
          <div *ngIf="totalPages > 1" class="pagination">
            <button 
              class="pagination-btn"
              [disabled]="currentPage === 1"
              (click)="goToPreviousPage()">
              Previous
            </button>
            <div class="page-numbers">
              <button
                *ngFor="let page of pageNumbers"
                class="page-btn"
                [class.active]="currentPage === page"
                (click)="goToPage(page)">
                {{ page }}
              </button>
            </div>
            <button 
              class="pagination-btn"
              [disabled]="currentPage === totalPages"
              (click)="goToNextPage()">
              Next
            </button>
          </div>
        </div>

        <!-- Empty Search State -->
        <ng-template #emptyState>
          <div class="empty-state">
            <div class="empty-icon">
              <lucide-icon [name]="Search" [size]="40"></lucide-icon>
            </div>
            <h3 class="empty-title">No categories found</h3>
            <p class="empty-description">
              Try adjusting your search to see more results
            </p>
          </div>
        </ng-template>
      </div>
    </div>
  </main>

  <!-- Category Modal - Replace the inline modal with this -->
  <app-category-modal
    [isOpen]="isModalOpen"
    [category]="editingCategory"
    (closeModal)="onModalClose()"
    (saveCategory)="onSaveCategory($event)">
  </app-category-modal>

  <!-- Delete Modal -->
  <app-delete-modal
    [isOpen]="isDeleteModalOpen"
    [item]="deleteModalData"
    [isLoading]="isDeleting"
    title="Delete Category"
    message="Are you sure you want to delete this category?"
    confirmText="Delete Category"
    (closeModal)="onDeleteModalClose()"
    (confirmDelete)="onConfirmDelete($event)">
  </app-delete-modal>
</div>
