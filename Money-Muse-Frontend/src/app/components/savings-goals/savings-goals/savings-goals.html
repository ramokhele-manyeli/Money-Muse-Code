<div class="savings-goals-layout">
  <!-- Navbar -->
  <app-navbar 
    [isOpen]="isMobileMenuOpen"
    [currentRoute]="currentRoute"
    (toggleMenu)="onToggleMobileMenu()"
    (closeMenu)="onCloseMobileMenu()"
    (navigateToRoute)="onNavigate($event)">
  </app-navbar>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-wrapper">
      <!-- Confetti Effect -->
      <div *ngIf="showConfetti" class="confetti-container">
        <div *ngFor="let i of getConfettiArray(); trackBy: trackByIndex" 
             class="confetti-piece"
             [style.left.%]="Math.random() * 100"
             [style.animation-delay.s]="Math.random() * 0.5"
             [style.animation-duration.s]="2 + Math.random() * 2">
        </div>
      </div>

      <!-- Header -->
      <div class="page-header">
        <div class="header-content">
          <div>
            <h1 class="page-title">Savings Goals</h1>
            <p class="page-subtitle">Track your progress towards financial objectives</p>
          </div>
          <button class="add-btn" (click)="isCreateModalOpen = true">
            <lucide-icon [name]="Plus" [size]="16"></lucide-icon>
            New Goal
          </button>
        </div>
      </div>

      <!-- Metrics Grid -->
      <div class="metrics-grid">
        <div class="metric-card" *ngFor="let metric of metricsData; trackBy: trackByMetricId">
          <div class="metric-header">
            <span class="metric-label">{{ metric.label }}</span>
            <lucide-icon [name]="metric.icon" [size]="18" class="metric-icon"></lucide-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ metric.value }}</div>
          </div>
        </div>
      </div>

      <!-- Overall Progress -->
      <div class="progress-card">
        <div class="progress-header">
          <h3 class="progress-title">Overall Progress</h3>
          <span class="progress-percentage">{{ overallProgress.toFixed(1) }}%</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" [ngClass]="getProgressColor(overallProgress)" 
               [style.width.%]="Math.min(overallProgress, 100)">
          </div>
        </div>
        <p class="progress-text">
          {{ formatCurrency(totalSaved) }} of {{ formatCurrency(totalTarget) }} saved
        </p>
      </div>

      <!-- Goals Grid -->
      <div class="goals-grid">
        <!-- Create New Goal Card -->
        <div class="create-goal-card" (click)="isCreateModalOpen = true">
          <div class="create-goal-content">
            <div class="create-goal-icon">
              <lucide-icon [name]="Plus" [size]="32"></lucide-icon>
            </div>
            <h3 class="create-goal-title">Create New Goal</h3>
            <p class="create-goal-description">
              Set a new savings target and start tracking your progress
            </p>
          </div>
        </div>

        <!-- Goal Cards -->
        <div *ngFor="let goal of goals; trackBy: trackByGoalId" class="goal-card" 
             [class.completed]="isGoalCompleted(goal)">
          <div class="goal-header">
            <div class="goal-info">
              <span class="goal-icon">{{ goal.icon }}</span>
              <div class="goal-title-section">
                <h3 class="goal-title">{{ goal.title }}</h3>
                <span *ngIf="isGoalCompleted(goal)" class="completion-badge">ðŸŽ‰ Completed!</span>
              </div>
            </div>
            <button class="delete-btn" (click)="handleDeleteGoal(goal.id)">
              <lucide-icon [name]="Trash2" [size]="16"></lucide-icon>
            </button>
          </div>

          <div class="goal-content">
            <!-- Progress Bar -->
            <div class="progress-section">
              <div class="progress-info">
                <span class="progress-label">Progress</span>
                <span class="progress-value" [style.color]="goal.color">
                  {{ getProgress(goal).toFixed(1) }}%
                </span>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar" 
                     [style.backgroundColor]="goal.color"
                     [style.width.%]="Math.min(getProgress(goal), 100)">
                </div>
              </div>
            </div>

            <!-- Amounts -->
            <div class="amounts-grid">
              <div class="amount-item">
                <p class="amount-label">Current</p>
                <p class="amount-value">{{ formatCurrency(goal.currentAmount) }}</p>
              </div>
              <div class="amount-item">
                <p class="amount-label">Target</p>
                <p class="amount-value">{{ formatCurrency(goal.targetAmount) }}</p>
              </div>
            </div>

            <!-- Goal Details -->
            <div class="goal-details">
              <div class="detail-row">
                <span class="detail-label">Remaining</span>
                <span class="detail-value">{{ formatCurrency(getRemainingAmount(goal)) }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Deadline</span>
                <span class="detail-value">{{ formatDate(goal.deadline) }}</span>
              </div>
            </div>

            <!-- Add Money Button -->
            <button 
              class="add-money-btn"
              [style.backgroundColor]="goal.color"
              [disabled]="isGoalCompleted(goal)"
              (click)="openAddMoneyModal(goal.id)">
              {{ isGoalCompleted(goal) ? 'Goal Completed! ðŸŽ‰' : 'Add Money' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Create Goal Modal -->
  <app-savings-goals-modal
    [isOpen]="isCreateModalOpen"
    (close)="onCreateModalClose()"
    (save)="onCreateModalSave($event)">
  </app-savings-goals-modal>

  <!-- Add Money Modal -->
  <div *ngIf="isAddMoneyModalOpen && selectedGoal" class="modal-overlay" (click)="onAddMoneyModalClose()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Add Money to {{ selectedGoal.title }}</h2>
        <button class="close-btn" (click)="onAddMoneyModalClose()">Ã—</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="handleAddMoney()" #moneyForm="ngForm">
          <div class="form-group">
            <label for="add-amount" class="form-label">Amount ($)</label>
            <input
              type="number"
              id="add-amount"
              [(ngModel)]="addMoneyAmount"
              name="amount"
              class="form-input"
              placeholder="100"
              min="1"
              [max]="getRemainingAmount(selectedGoal)"
              required>
          </div>

          <div class="goal-summary">
            <p class="summary-item">Current: {{ formatCurrency(selectedGoal.currentAmount) }}</p>
            <p class="summary-item">Remaining: {{ formatCurrency(getRemainingAmount(selectedGoal)) }}</p>
          </div>

          <button 
            type="submit" 
            class="submit-btn"
            [style.backgroundColor]="selectedGoal.color"
            [disabled]="!moneyForm.valid">
            Add Money
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
