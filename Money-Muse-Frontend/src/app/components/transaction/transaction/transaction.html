<div class="transaction-layout">
  <!-- Navbar -->
  <app-navbar 
    [isOpen]="isMobileMenuOpen"
    [currentRoute]="currentRoute"
    (toggleMenu)="onToggleMobileMenu()"
    (closeMenu)="onCloseMobileMenu()"
    (navigateToRoute)="onNavigate($event)">
  </app-navbar>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-wrapper">
      <!-- Header -->
      <div class="page-header">
        <div class="header-content">
          <div>
            <h1 class="page-title">Transactions</h1>
            <p class="page-subtitle">Manage and track all your financial transactions</p>
          </div>
          <button class="add-btn" (click)="handleAddTransaction()">
            <lucide-icon [name]="Plus" [size]="16"></lucide-icon>
            Add Transaction
          </button>
        </div>
      </div>

      <!-- Metrics Grid - moved above everything like dashboard -->
      <div class="metrics-grid">
        <div class="metric-card" *ngFor="let metric of metricsData; trackBy: trackByMetricId">
          <div class="metric-header">
            <span class="metric-label">{{ metric.label }}</span>
            <lucide-icon [name]="metric.icon" [size]="18" class="metric-icon"></lucide-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ metric.value }}</div>
            <p class="metric-change" [class.positive]="metric.changeType === 'positive'" [class.negative]="metric.changeType === 'negative'">
              <span *ngIf="metric.change">{{ metric.change }}</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Main Content Section - now full width -->
      <div class="main-section">
        <!-- Filters -->
        <div class="filter-card">
          <div class="filter-grid">
            <!-- Search -->
            <div class="search-container">
              <lucide-icon [name]="Search" [size]="16" class="search-icon"></lucide-icon>
              <input
                type="text"
                placeholder="Search transactions..."
                [(ngModel)]="searchQuery"
                class="search-input"
              />
            </div>

            <!-- Category Filter -->
            <div class="filter-wrapper">
              <app-custom-select
                [options]="categoryOptions"
                [value]="selectedCategory"
                (valueChange)="selectedCategory = $event"
                placeholder="Select Category">
              </app-custom-select>
            </div>

            <!-- Type Filter -->
            <div class="filter-wrapper">
              <app-custom-select
                [options]="typeOptions"
                [value]="selectedType"
                (valueChange)="selectedType = $event"
                placeholder="Select Type">
              </app-custom-select>
            </div>
          </div>
        </div>

        <!-- Transactions -->
        <div *ngIf="paginatedTransactions.length > 0; else emptyState">
          <!-- Desktop Table View -->
          <div class="desktop-table">
            <table class="transactions-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th class="text-right">Amount</th>
                  <th class="text-right">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let transaction of paginatedTransactions; trackBy: trackByTransactionId" class="transaction-row">
                  <td>
                    <div class="date-cell">
                      <lucide-icon [name]="Calendar" [size]="14" class="calendar-icon"></lucide-icon>
                      {{ formatDate(transaction.date) }}
                    </div>
                  </td>
                  <td>
                    <div class="description-cell">
                      <div class="transaction-icon" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                        <lucide-icon [name]="transaction.icon" [size]="18"></lucide-icon>
                      </div>
                      <span class="description-text">{{ transaction.description }}</span>
                    </div>
                  </td>
                  <td>
                    <span class="category-badge" [ngClass]="getCategoryColorClass(transaction.category)">
                      {{ transaction.category }}
                    </span>
                  </td>
                  <td class="text-right">
                    <span class="amount" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                      {{ transaction.type === 'income' ? '+' : '-' }}${{ formatAmount(transaction.amount) }}
                    </span>
                  </td>
                  <td class="text-right">
                    <div class="action-buttons">
                      <button class="action-btn edit-btn" (click)="handleEditTransaction(transaction)">
                        <lucide-icon [name]="Edit2" [size]="14"></lucide-icon>
                      </button>
                      <button class="action-btn delete-btn" (click)="handleDeleteTransaction(transaction)">
                        <lucide-icon [name]="Trash2" [size]="14"></lucide-icon>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Mobile Card View -->
          <div class="mobile-cards">
            <div *ngFor="let transaction of paginatedTransactions; trackBy: trackByTransactionId" class="mobile-card">
              <div class="card-header">
                <div class="card-info">
                  <div class="transaction-icon" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                    <lucide-icon [name]="transaction.icon" [size]="18"></lucide-icon>
                  </div>
                  <div class="transaction-details">
                    <p class="transaction-description">{{ transaction.description }}</p>
                    <p class="transaction-date">
                      <lucide-icon [name]="Calendar" [size]="12" class="inline"></lucide-icon>
                      {{ formatDate(transaction.date) }}
                    </p>
                  </div>
                </div>
                <span class="amount" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                  {{ transaction.type === 'income' ? '+' : '-' }}${{ formatAmount(transaction.amount) }}
                </span>
              </div>
              <div class="card-footer">
                <span class="category-badge" [ngClass]="getCategoryColorClass(transaction.category)">
                  {{ transaction.category }}
                </span>
                <div class="action-buttons">
                  <button class="action-btn edit-btn" (click)="handleEditTransaction(transaction)">
                    <lucide-icon [name]="Edit2" [size]="14"></lucide-icon>
                  </button>
                  <button class="action-btn delete-btn" (click)="handleDeleteTransaction(transaction)">
                    <lucide-icon [name]="Trash2" [size]="14"></lucide-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Pagination -->
          <div *ngIf="totalPages > 1" class="pagination">
            <button 
              class="pagination-btn"
              [disabled]="currentPage === 1"
              (click)="goToPreviousPage()">
              Previous
            </button>
            <div class="page-numbers">
              <button
                *ngFor="let page of pageNumbers"
                class="page-btn"
                [class.active]="currentPage === page"
                (click)="goToPage(page)">
                {{ page }}
              </button>
            </div>
            <button 
              class="pagination-btn"
              [disabled]="currentPage === totalPages"
              (click)="goToNextPage()">
              Next
            </button>
          </div>
        </div>

        <!-- Empty State -->
        <ng-template #emptyState>
          <div class="empty-state">
            <div class="empty-icon">
              <lucide-icon [name]="FileText" [size]="40"></lucide-icon>
            </div>
            <h3 class="empty-title">No transactions found</h3>
            <p class="empty-description">
              <span *ngIf="searchQuery || selectedCategory !== 'All Categories' || selectedType !== 'all'; else noFiltersText">
                Try adjusting your filters to see more results
              </span>
              <ng-template #noFiltersText>
                Get started by adding your first transaction
              </ng-template>
            </p>
          </div>
        </ng-template>
      </div>
    </div>
  </main>

  <!-- Transaction Modal -->
  <app-transaction-modal
    [isOpen]="isModalOpen"
    [transaction]="editingTransaction"
    (closeModal)="onModalClose()"
    (saveTransaction)="onSaveTransaction($event)">
  </app-transaction-modal>

  <!-- Delete Modal -->
  <app-delete-modal
    [isOpen]="isDeleteModalOpen"
    [item]="deleteModalData"
    [isLoading]="isDeleting"
    title="Delete Transaction"
    message="Are you sure you want to delete this transaction?"
    confirmText="Delete Transaction"
    (closeModal)="onDeleteModalClose()"
    (confirmDelete)="onConfirmDelete($event)">
  </app-delete-modal>
</div>
